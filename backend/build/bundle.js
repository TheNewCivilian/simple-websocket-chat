!function(e){var r={};function t(s){if(r[s])return r[s].exports;var o=r[s]={i:s,l:!1,exports:{}};return e[s].call(o.exports,o,o.exports,t),o.l=!0,o.exports}t.m=e,t.c=r,t.d=function(e,r,s){t.o(e,r)||Object.defineProperty(e,r,{enumerable:!0,get:s})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,r){if(1&r&&(e=t(e)),8&r)return e;if(4&r&&"object"==typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(t.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&r&&"string"!=typeof e)for(var o in e)t.d(s,o,function(r){return e[r]}.bind(null,o));return s},t.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(r,"a",r),r},t.o=function(e,r){return Object.prototype.hasOwnProperty.call(e,r)},t.p="",t(t.s=0)}([function(e,r,t){const s=t(1),o=t(2),n=t(3),a=new o.Server({port:8e3});console.log("Websocket Server started on 8000"),a.on("connection",e=>{n.onConnect(e),e.on("message",r=>{n.onMessage(a,e,r)}),e.on("close",()=>{n.onClose(e)})});const u=s();u.use(s.static("public")),u.get("/",(e,r)=>r.send("Hello World!")),u.listen(3e3,()=>console.log("Example app listening at http://localhost:3000"))},function(e,r){e.exports=require("express")},function(e,r){e.exports=require("ws")},function(e,r,t){const s=t(4),o=(e,r)=>{e.send(JSON.stringify(r))},n=(e,r,t)=>{t.broadcast?((e,r)=>{e.clients&&e.clients.forEach(e=>{o(e,r)})})(e,t.message):o(r,t.message)};e.exports={onConnect:e=>{o(e,{error:!1})},onMessage:(e,r,t)=>{const a=(e=>{let r,t=!1;try{r=JSON.parse(e)}catch(e){t=!0}if(t)return"string"==typeof e?{method:e}:{error:!0};const s=Object.keys(r)[0];return{method:s,data:r[s]}})(t);let u=[];if(a.error)o(r,s.dataFormatError);else switch(console.log(a),a.method){case"SUB":if(!a.data.name||!a.data.userId)return void o(r,s.dataFormatError);r.userName=a.data.name,r.userId=a.data.userId,u=[],e.clients&&e.clients.forEach(e=>u.push({userId:e.userId,username:e.userName})),n(e,r,{broadcast:!0,message:{users:u}}),o(r,{user:r.userName});break;case"UNSUB":u=[],e.clients&&e.clients.forEach(e=>u.push(e.userId)),n(e,r,{broadcast:!0,message:{users:u}});break;case"SEND":if(!a.data.text)return void o(r,s.dataFormatError);a.data.userId?(e.clients.forEach(e=>{e.userId==a.data.userId&&o(e,{text:a.data.text,userId:r.userId,userName:r.userName})}),n(e,r,{broadcast:!1,message:{text:a.data.text,userId:r.userId,userName:r.userName}})):n(e,r,{broadcast:!0,message:{text:a.data.text,userId:r.userId,userName:r.userName}});default:n(e,r,s.methodNotFound)}},onClose:e=>{const r=[];websocket.clients&&websocket.clients.forEach(e=>r.push(e.userId)),n(websocket,e,{broadcast:!0,message:{users:r}})}}},function(e,r){e.exports={dataFormatError:{error:!0,message:"DATA_FORMAT_ERROR"},userExists:{error:!0,message:"USER_EXISTS_ERROR"},channelNotExisting:{error:!0,message:"NO_CHANNEL_FOUND"},methodNotFound:{error:!0,message:"METHOD_NOT_FOUND"}}}]);